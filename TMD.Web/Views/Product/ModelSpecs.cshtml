@model TMD.Web.ViewModels.Product.ProductModelViewModel
@{
    int productId = Model.ProductModel.ProductId > 0 ? Model.ProductModel.ProductId : 0;
    int productModelId = Model.ProductModel.ProductModelId > 0 ? Model.ProductModel.ProductModelId : 0;
    string createUpdate = Model.ProductModel.ProductModelId > 0 ? "Update" : "Add New";
    ViewBag.Title = createUpdate + " Product Model";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}


@using (Html.BeginForm("ModelSpecs", "Product", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
{

    @Html.AntiForgeryToken()
    <div class="portlet light bg-inverse">
        <ul class="nav nav-pills nav-justified steps">
            <li>
                <a href='@Url.Action("Create", "Product",new {id=productId})' class="step">
                    <span class="number">
                        1 -
                    </span>
                    <span class="desc">
                        <i class='fa fa-check'></i> Product basic detail
                    </span>
                </a>
            </li>
            <li class="active">
                <a href='@Url.Action("ModelSpecs", "Product",new {id=productModelId})' class="step">
                    <span class="number">
                        2 -
                    </span>
                    <span class="desc">
                        <i class='@(productModelId > 0 ? "fa fa-check" : "")'></i> Product model and Technical specs.
                    </span>
                </a>
            </li>
        </ul>
        <div class="portlet-title">
            <div class="caption">
                <i class="icon-handbag font-red-sunglo"></i>
                <span class="caption-subject font-red-sunglo bold uppercase">Product Model</span>
                <span class="caption-helper">@ViewBag.Title and Technical Specs.</span>
            </div>
        </div>

        <div class="portlet-body form">
            <div class="form-body">
                <div class="row">
                    <!--/span-->
                    <div class="col-md-6">
                        <div class="form-group">
                            @Html.LabelFor(model => model.ProductModel.ModelName, new {@class = "control-label col-md-3 requiredLabel"})
                            <div class="col-md-9">
                                @Html.TextBoxFor(model => model.ProductModel.ModelName, new {@class = "form-control", placeholder = "Enter product model name"})
                                @Html.ValidationMessageFor(model => model.ProductModel.ModelName)
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            @Html.LabelFor(model => model.ProductModel.ModelDescription, new {@class = "control-label col-md-3 requiredLabel"})
                            <div class="col-md-9">
                                @Html.TextAreaFor(model => model.ProductModel.ModelDescription, new {@class = "form-control", placeholder = "Enter product model description"})
                            </div>
                        </div>
                    </div>
                    <!--/span-->
                </div>
                <h3 class="form-section">Technical Specs.</h3>
                <div class="row">
                    <!--/span-->
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="control-label col-md-3">Technical Spec.</label>
                            <div class="col-md-7">
                                @Html.DropDownList("Specs", new SelectList(Model.TechnicalSpecs, "TechnicalSpecId", "SpecName"), "Select Technical Specification", new {@class = "form-control select2me mandatoryModal", id = "TechSpecId"})
                            </div>
                            
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="col-md-2">
                                <button type="button" class="btn green-meadow prominent" id="TechnicalSpecAddBtn" title="Add Technical Spec.">
                                    <i class="fa fa-plus-square-o"></i>
                                    Add
                                </button>
                            </div>
                        </div>
                    </div>
                    <!--/span-->
                </div>
                <div class="row hideOthersDetail">
                    <div class="portlet box">
                        <div class="portlet-body flip-scroll">
                            <table class="table table-bordered table-striped table-condensed flip-content" id="supervisorTable">
                                <thead class="flip-content">
                                <tr>
                                    <th style="display: none"></th>
                                    <th>
                                        Name
                                    </th>
                                    <th>
                                        Value
                                    </th>
                                    <th>
                                        <span class="mustDisplay">Remove</span>
                                    </th>
                                </tr>
                                </thead>
                                <tbody id="techspecBody">
                                @if (Model.ProductTechnicalSpec != null)
                                {
                                    for (int i = 0; i < Model.ProductTechnicalSpec.Count; i++)
                                    {
                                        <tr data-id="@i">
                                            <td style="display: none">
                                                <input name='ProductTechnicalSpec.Index' type='hidden' value='@i'/>
                                                <input name='ProductTechnicalSpec[@i].ProductTechSpecsId' type='hidden' value='@Model.ProductTechnicalSpec[i].ProductTechSpecsId'/>
                                                <input name='ProductTechnicalSpec[@i].ProductModelId' type='hidden' value='@Model.ProductTechnicalSpec[i].ProductModelId'/>
                                            </td>
                                            <td>
                                                @Model.ProductTechnicalSpec[i].TechSpecName
                                            </td>
                                            <td>@Model.ProductTechnicalSpec[i].SpecValue</td>
                                            <td><a class='remove mustDisplay' href='javascript:;'>Remove</a></td>
                                        </tr>
                                    }
                                }

                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </div>

            <!--/row-->
        </div>

        <div class="form-actions">
            <div class="row">
                <div class="col-md-6">
                    <div class="row">
                        <div class="col-md-offset-3 col-md-9">
                            <input type="submit" class="btn green-seagreen hideOthersDetail" value="Submit"/>
                            <button type="reset" class="btn green-jungle hideOthersDetail">Reset</button>
                            <a href="~/Employees/Index" class="btn default cancelBtn">Cancel</a>

                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                </div>
            </div>
        </div>
    </div>
}
<script>
    $('#TechnicalSpecAddBtn').on("click", function () {
        //validate fields
        if (!(ValidateFieldsByClass("mandatoryModal"))) {
            return false;
        }

        var selectedTechSpecId = $("#TechSpecId option:selected").text().toLowerCase().indexOf("select") >= 0 ? "" : $("#TechSpecId option:selected").text();

        var itemRowIndex = "";
        var index = $("#techspecBody").children("tr").length;
        var productId = $("#ProductModel_ProductId").val();
        if (itemRowIndex === "") {
            //    //add new row

            if ($("#techspecBody").children("tr").children("td").html() == "No data available in table") {
                index = index - 1;
                $("#techspecBody").children("tr").remove();
            }
            var indexCell = "<td style='display:none'>" +
                "<input name='ProductTechnicalSpec.Index' type='hidden' value='" + index + "' />" +
                "<input name='ProductTechnicalSpec[" + index + "].ProductModelId'  type='hidden'  value='" + productId + "'/>" +
                "<input name='ProductTechnicalSpec[" + index + "].ProductTechSpecsId' type='hidden' />" +
                "</td>";

            //ProductTechnicalSpec
            var html = ' <tr data-id=' + index + '>' +
                indexCell +
                '<td>' +
                '<input id="ProductTechnicalSpec_' + index + '__Barcode" name="ProductTechnicalSpec[' + index + '].Barcode" value="' + itemBarcode + '" type="text" class = "ProductTableColumn" readOnly = "readOnly"/>' +
                '</td>' +
                '<td>' +
                '<input id="ProductTechnicalSpec_' + index + '__UnitId" name="ProductTechnicalSpec[' + index + '].UnitId" value="' + itemUnitId + '" type="hidden"/><input type="text" id="ProductTechnicalSpec_' + index + '__UnitTitle" class="ProductTableColumn" value="' + itemUnitTitle + '"/>' +
                '</td>' +
                '<td>' +
                '<input id="ProductTechnicalSpec_' + index + '__ShelfId" name="ProductTechnicalSpec[' + index + '].ShelfId" value="' + itemShelfId + '" type="hidden"/><input type="text" id="ProductTechnicalSpec_' + index + '__ShelfTitle" class="ProductTableColumn" value="' + itemShelfTitle + '"/>' +
                '</td>' +
                '<td>' +
                '<input id="ProductTechnicalSpec_' + index + '__MinimumStockLimit" name="ProductTechnicalSpec[' + index + '].MinimumStockLimit" value="' + itemMinStockLevel + '" type="text" class = "ProductTableColumn" readOnly = "readOnly"/>' +
                '</td>' +
                '<td>' +
                '<input id="ProductTechnicalSpec_' + index + '__ProductVariantDescription" name="ProductTechnicalSpec[' + index + '].ProductVariantDescription" value="' + itemDescription + '" type="text" class = "ProductTableColumn" readOnly = "readOnly"/>' +
                '</td>' +
                '<td>' +
                '<a href="javascript:;" class="btn default btn-xs blue editRow" title="Edit"><i class="fa fa-pencil"></i></a>' +
                '&nbsp;<a href="javascript:;" class="btn default btn-xs red deleteRow" title="Delete"><i class="fa fa-trash-o"></i></a>' +
                '</td>' +
                '</tr>';
            $('#techspecBody').append(html);
        } 
    });
</script>