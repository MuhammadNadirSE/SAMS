@model Angle.ViewModels.BillDetail.BillDetailListViewModel

@{
    ViewBag.Title = "Bill Details";
    Layout = "~/Views/Shared/_AngleLayout.cshtml";
}

<h2>Bill Details</h2>

<div class="row">
    <div class="col-lg-12">
        <div class="panel panel-default">
            <div class="panel-body">
                <table id="billDetails" class="table table-striped table-hover">
                    <thead>
                    <tr>
                        <th></th>
                        <th>Account Number</th>
                        <th>Bill Issue Date</th>
                        <th>Service Number</th>
                        <th>Service Type</th>
                        <th>Charge Type</th>
                        <th>Description</th>
                        <th>Quantity</th>
                        <th>Incl Gst</th>
                    </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    var start = ('@Model.SearchRequest.PageNo' - 1) * '@Model.SearchRequest.PageSize';
    var isAsc = '@Model.SearchRequest.IsAsc' == "True" || '@Model.SearchRequest.IsAsc' == "true";
    var sortBy = ['@Model.SearchRequest.SortBy', isAsc ? 'asc' : 'desc'];
    $(document).ready(function () {

        var tableColumns = [
            {
                "aTargets": [0],
                "sDefaultContent": "No Data",
                "mRender": function (data, type, full) {
                    var element;
                    var val;
                    var billDetailId;
                    val = full["BillDetailId"];
                    billDetailId = full["BillDetailId"];
                    element = '<a href="/BillDetail/AddEdit/' + billDetailId + '">' + val + '</a>';
                    return element;
                }
            },
            { "data": "AccountNumber" },
            { "data": "BillIssueDate" },
            { "data": "ServiceNumber" },
            { "data": "ServiceType" },
            { "data": "ChargeType" },
            { "data": "Description" },
            { "data": "Quantity" },
            { "data": "InclGst" }
        ];

        var billDetails = $('#billDetails').dataTable({
            "iDisplayLength": 11,
            "displayStart": start || 0,
            "bLengthChange": false,
            "aaSorting": [sortBy],
            //"oLanguage": {
            //    sProcessing: '<img src="/Images/gears.gif">'
            //},
            "bProcessing": true,
            "columns": tableColumns,
            "processing": true,
            "serverSide": true,

            "ajax": {
                url: "/BillDetail/Index",
                type: "POST",
                dataType: "json",
                data: function (params) {
                    params.PageNo = Math.ceil(params.start / params.length) + 1;
                    if (params.PageNo === 0) {
                        params.PageNo = 1;
                    }
                    params.PageSize = params.length;
                    params.SortBy = params.order[0].column;
                    params.IsAsc = params.order[0].dir === "asc";

                    params.BillDetailId = $('#BillDetailId').val();
                    params.AccountNumber = $('#AccountNumber').val();
                    params.BillIssueDate = $('#BillIssueDate').val();
                    params.ServiceNumber = $('#ServiceNumber').val();
                    params.ServiceType = $('#ServiceType').val();
                    params.Description = $('#Description').val();
                    params.Quantity = $('#Quantity').val();
                    params.InclGst = $('#InclGst').val();
                }
            },
            sDom: 'C<"clear">lfrtip',
            colVis: {
                order: 'alfa',
                'buttonText': 'Show/Hide Columns'
            },
            oLanguage: {
                sSearch: 'Search all columns:',
                sLengthMenu: '_MENU_ records per page',
                info: 'Showing page _PAGE_ of _PAGES_',
                zeroRecords: 'Nothing found - sorry',
                infoEmpty: 'No records available',
                infoFiltered: '(filtered from _MAX_ total records)'
            }
        });
        $(".dataTables_filter input").unbind()
            .bind("input", function (e) {
                // Bind our desired behavior
                if (this.value.length >= 3 || e.keyCode == 13) {
                    $("#searchString").val(this.value);
                    oTable.fnDraw();
                }
                if (this.value == "") {
                    $("#searchString").val(this.value);
                    oTable.fnDraw();
                }
                return;
            });
    });

</script>